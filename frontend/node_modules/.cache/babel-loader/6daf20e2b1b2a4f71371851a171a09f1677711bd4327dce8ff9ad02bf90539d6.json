{"ast":null,"code":"var _jsxFileName = \"/Users/kapilshinde/Desktop/Medisync/frontend/src/pages/patient/PaymentPage.jsx\",\n  _s = $RefreshSig$();\nimport { useEffect, useState } from \"react\";\nimport API from \"../../api/api\";\nimport Navbar from \"../../components/Navbar\";\nimport { jwtDecode } from \"jwt-decode\";\nimport { jsxDEV as _jsxDEV, Fragment as _Fragment } from \"react/jsx-dev-runtime\";\nfunction PaymentPage() {\n  _s();\n  const [pending, setPending] = useState(null);\n  const [loading, setLoading] = useState(true);\n  const [patientId, setPatientId] = useState(null);\n\n  // ðŸ” STEP 1 â€“ Get patient id from JWT\n  useEffect(() => {\n    const token = sessionStorage.getItem(\"token\");\n    if (token) {\n      const decoded = jwtDecode(token);\n      setPatientId(decoded.id);\n    }\n  }, []);\n\n  // ðŸ” STEP 2 â€“ Load pending bill AFTER patientId available\n  useEffect(() => {\n    if (patientId) {\n      loadPending();\n    }\n  }, [patientId]);\n  const loadPending = async () => {\n    try {\n      const {\n        data\n      } = await API.get(`/bills/pending/${patientId}`);\n      setPending(data);\n    } catch (err) {\n      setPending({\n        hasPending: false\n      });\n    } finally {\n      setLoading(false);\n    }\n  };\n\n  // ðŸ’³ STEP 3 â€“ Razorpay Payment\n  const payNow = async () => {\n    try {\n      const {\n        data\n      } = await API.post(\"http://localhost:5005/payment/create-order\", {\n        amount: pending.amount,\n        patientId: patientId,\n        appointmentId: pending.appointmentId\n      });\n      const options = {\n        key: \"RAZORPAY_KEY_ID\",\n        // <-- replace later\n\n        order_id: data.id,\n        handler: async function (response) {\n          await API.post(\"http://localhost:5005/payment/verify\", response);\n          alert(\"Payment Successful\");\n          loadPending();\n        },\n        theme: {\n          color: \"#0d6efd\"\n        }\n      };\n      const rzp = new window.Razorpay(options);\n      rzp.open();\n    } catch (err) {\n      var _err$response, _err$response$data;\n      alert(((_err$response = err.response) === null || _err$response === void 0 ? void 0 : (_err$response$data = _err$response.data) === null || _err$response$data === void 0 ? void 0 : _err$response$data.message) || \"Payment failed\");\n    }\n  };\n  return /*#__PURE__*/_jsxDEV(_Fragment, {\n    children: [/*#__PURE__*/_jsxDEV(Navbar, {}, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 88,\n      columnNumber: 7\n    }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n      className: \"container mt-4\",\n      children: [/*#__PURE__*/_jsxDEV(\"h3\", {\n        children: \"Payment Gateway\"\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 92,\n        columnNumber: 9\n      }, this), loading && /*#__PURE__*/_jsxDEV(\"p\", {\n        children: \"Loading...\"\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 94,\n        columnNumber: 21\n      }, this), !loading && !(pending !== null && pending !== void 0 && pending.hasPending) && /*#__PURE__*/_jsxDEV(\"div\", {\n        className: \"alert alert-success\",\n        children: \"No payment pending\"\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 97,\n        columnNumber: 11\n      }, this), !loading && (pending === null || pending === void 0 ? void 0 : pending.hasPending) && /*#__PURE__*/_jsxDEV(\"div\", {\n        className: \"card p-3\",\n        children: [/*#__PURE__*/_jsxDEV(\"h5\", {\n          children: \"Pending Bill\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 104,\n          columnNumber: 13\n        }, this), /*#__PURE__*/_jsxDEV(\"p\", {\n          children: [\"Amount: \\u20B9\", pending.amount]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 106,\n          columnNumber: 13\n        }, this), /*#__PURE__*/_jsxDEV(\"button\", {\n          className: \"btn btn-primary\",\n          onClick: payNow,\n          children: \"Pay Now\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 108,\n          columnNumber: 13\n        }, this)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 103,\n        columnNumber: 11\n      }, this)]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 90,\n      columnNumber: 7\n    }, this)]\n  }, void 0, true);\n}\n_s(PaymentPage, \"pBJoSqjJ11MOnEdEKdbKnfsnHwc=\");\n_c = PaymentPage;\nexport default PaymentPage;\nvar _c;\n$RefreshReg$(_c, \"PaymentPage\");","map":{"version":3,"names":["useEffect","useState","API","Navbar","jwtDecode","jsxDEV","_jsxDEV","Fragment","_Fragment","PaymentPage","_s","pending","setPending","loading","setLoading","patientId","setPatientId","token","sessionStorage","getItem","decoded","id","loadPending","data","get","err","hasPending","payNow","post","amount","appointmentId","options","key","order_id","handler","response","alert","theme","color","rzp","window","Razorpay","open","_err$response","_err$response$data","message","children","fileName","_jsxFileName","lineNumber","columnNumber","className","onClick","_c","$RefreshReg$"],"sources":["/Users/kapilshinde/Desktop/Medisync/frontend/src/pages/patient/PaymentPage.jsx"],"sourcesContent":["import { useEffect, useState } from \"react\";\nimport API from \"../../api/api\";\nimport Navbar from \"../../components/Navbar\";\nimport { jwtDecode } from \"jwt-decode\";\n\nfunction PaymentPage() {\n\n  const [pending, setPending] = useState(null);\n  const [loading, setLoading] = useState(true);\n  const [patientId, setPatientId] = useState(null);\n\n  // ðŸ” STEP 1 â€“ Get patient id from JWT\n  useEffect(() => {\n    const token = sessionStorage.getItem(\"token\");\n\n    if (token) {\n      const decoded = jwtDecode(token);\n      setPatientId(decoded.id);\n    }\n  }, []);\n\n  // ðŸ” STEP 2 â€“ Load pending bill AFTER patientId available\n  useEffect(() => {\n    if (patientId) {\n      loadPending();\n    }\n  }, [patientId]);\n\n  const loadPending = async () => {\n    try {\n      const { data } = await API.get(\n        `/bills/pending/${patientId}`\n      );\n\n      setPending(data);\n\n    } catch (err) {\n      setPending({ hasPending: false });\n\n    } finally {\n      setLoading(false);\n    }\n  };\n\n  // ðŸ’³ STEP 3 â€“ Razorpay Payment\n  const payNow = async () => {\n    try {\n\n      const { data } = await API.post(\n        \"http://localhost:5005/payment/create-order\",\n        {\n          amount: pending.amount,\n          patientId: patientId,\n          appointmentId: pending.appointmentId,\n        }\n      );\n\n      const options = {\n        key: \"RAZORPAY_KEY_ID\",   // <-- replace later\n\n        order_id: data.id,\n\n        handler: async function (response) {\n\n          await API.post(\n            \"http://localhost:5005/payment/verify\",\n            response\n          );\n\n          alert(\"Payment Successful\");\n\n          loadPending();\n        },\n\n        theme: { color: \"#0d6efd\" },\n      };\n\n      const rzp = new window.Razorpay(options);\n      rzp.open();\n\n    } catch (err) {\n      alert(err.response?.data?.message || \"Payment failed\");\n    }\n  };\n\n  return (\n    <>\n      <Navbar />\n\n      <div className=\"container mt-4\">\n\n        <h3>Payment Gateway</h3>\n\n        {loading && <p>Loading...</p>}\n\n        {!loading && !pending?.hasPending && (\n          <div className=\"alert alert-success\">\n            No payment pending\n          </div>\n        )}\n\n        {!loading && pending?.hasPending && (\n          <div className=\"card p-3\">\n            <h5>Pending Bill</h5>\n\n            <p>Amount: â‚¹{pending.amount}</p>\n\n            <button\n              className=\"btn btn-primary\"\n              onClick={payNow}\n            >\n              Pay Now\n            </button>\n          </div>\n        )}\n\n      </div>\n    </>\n  );\n}\n\nexport default PaymentPage;\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}